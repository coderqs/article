<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>openssl on 清松小站</title><link>https://coderqs.github.io/tags/openssl/</link><description>Recent content in openssl on 清松小站</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 15 Sep 2021 23:37:00 +0800</lastBuildDate><atom:link href="https://coderqs.github.io/tags/openssl/index.xml" rel="self" type="application/rss+xml"/><item><title>OpenSSL 自签证书</title><link>https://coderqs.github.io/2021/09/openssl-%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6/</link><pubDate>Wed, 15 Sep 2021 23:37:00 +0800</pubDate><guid>https://coderqs.github.io/2021/09/openssl-%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6/</guid><description>&lt;h1 id="openssl-自签证书">OpenSSL 自签证书&lt;/h1>
&lt;h2 id="检查openssl">检查OpenSSL&lt;/h2>
&lt;p>检查是否已经安装openssl：&lt;/p>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>一般情况下系统会默认安装。&lt;/p>
&lt;h2 id="生成自签名的ssl证书和私钥">生成自签名的SSL证书和私钥&lt;/h2>
&lt;h3 id="1-生成私钥">1. 生成私钥&lt;/h3>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl genrsa -des3 -out server.pass.key 2048
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参数解析:&lt;/p>
&lt;ul>
&lt;li>&lt;code>genra&lt;/code> 生成RSA私钥&lt;/li>
&lt;li>&lt;code>-des3&lt;/code> des3算法&lt;/li>
&lt;li>&lt;code>-out&lt;/code> server.key 生成的私钥文件名&lt;/li>
&lt;li>&lt;code>2048&lt;/code> 私钥长度&lt;/li>
&lt;/ul>
&lt;h3 id="2-去除私钥中的密码">2. 去除私钥中的密码&lt;/h3>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl rsa -in server.pass.key -out server.key
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>注意：有密码的私钥是server.pass.key，没有密码的私钥是server.key&lt;/strong>&lt;/p>
&lt;h3 id="3-生成csr证书签名请求">3. 生成CSR(证书签名请求)&lt;/h3>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl req -new -key server.key -out server.csr -subj &amp;#34;/C=CN/ST=Guangdong/L=Guangzhou/O=xdevops/OU=xdevops/CN=gitlab.xdevops.cn&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>req&lt;/code> 生成证书签名请求&lt;/li>
&lt;li>&lt;code>-new&lt;/code> 新生成&lt;/li>
&lt;li>&lt;code>-key&lt;/code> 私钥文件&lt;/li>
&lt;li>&lt;code>-out&lt;/code> 生成的CSR文件&lt;/li>
&lt;li>&lt;code>-subj&lt;/code> 生成CSR证书的参数&lt;/li>
&lt;/ul>
&lt;p>&lt;code>subj&lt;/code> 参数说明如下：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>字段&lt;/th>
&lt;th>字段含义&lt;/th>
&lt;th>示例&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>/C=&lt;/td>
&lt;td>Country 国家&lt;/td>
&lt;td>CN&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/ST=&lt;/td>
&lt;td>State or Province 省&lt;/td>
&lt;td>Guangdong&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/L=&lt;/td>
&lt;td>Location or City 城市&lt;/td>
&lt;td>Guangzhou&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/O=&lt;/td>
&lt;td>Organization 组织或企业&lt;/td>
&lt;td>xdevops&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/OU=&lt;/td>
&lt;td>Organization Unit 部门&lt;/td>
&lt;td>xdevops&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/CN=&lt;/td>
&lt;td>Common Name 域名或IP&lt;/td>
&lt;td>gitlab.xdevops.cn&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="4-生成自签名ssl证书">4. 生成自签名SSL证书&lt;/h3>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>-days&lt;/code> 证书有效期&lt;/li>
&lt;li>&lt;code>x509&lt;/code> 证书的格式&lt;/li>
&lt;/ul>
&lt;h2 id="补充">补充&lt;/h2>
&lt;h3 id="1-从命令行中使用密码生成私钥">1. 从命令行中使用密码生成私钥&lt;/h3>
&lt;p>使用参数 &lt;code>-passout&lt;/code>，可以从命令行、文件、标准流输入密码&lt;/p>
&lt;h4 id="命令行">命令行&lt;/h4>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl genrsa -aes128 -passout pass:password 3072
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="文件">文件&lt;/h4>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>openssl genrsa -aes128 -passout file:password.txt 3072
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标准流">标准流&lt;/h4>
&lt;div class="highlight">&lt;div style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
&lt;table style="border-spacing:0;padding:0;margin:0;border:0;">&lt;tr>&lt;td style="vertical-align:top;padding:0;margin:0;border:0;">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code>&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#686868">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
&lt;pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span>echo &amp;#34;password&amp;#34; | openssl genrsa -aes128 -passout stdin 3072
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>注意：&lt;code>-passout&lt;/code> 参数一定要在参数&lt;code>-out&lt;/code>和加密位数之前，否则不生效&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>@Mawg: OpenSSL doesn&amp;rsquo;t like it if the -out param comes after the
2048 - really, that&amp;rsquo;s supposed to be the last thing on the command
line (I&amp;rsquo;ve updated my answer as such). See the last example, I think
that&amp;rsquo;s what you want. As for AES-128, someone I trust in these matters
recommends it over AES-256.&lt;/p>
&lt;/blockquote>
&lt;p>参考自：&lt;a class="link" href="https://stackoverflow.com/questions/4294689/how-to-generate-an-openssl-key-using-a-passphrase-from-the-command-line" target="_blank" rel="noopener"
>How to generate an openSSL key using a passphrase from the
command
line?&lt;/a>&lt;/p></description></item></channel></rss>